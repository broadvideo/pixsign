'use strict';var Attendance=function(a,b){var c=this;this.zonediv=a,this.zone=b,this.currentEvent=null,common.attendance.push(this);var d=0,e=function(a){if(a.id){$('.attendance-item').each(function(b,c){$(c).data('id')==a.id&&($(c).find('img').removeClass('opacity'),$(c).addClass('rubberBand'),setTimeout(function(){$(c).removeClass('rubberBand')},1e3))}),$('.attendance-popup').remove();var b=doT.template('<div class="attendance-popup animated" data-id="{{=it.id}}">\n                <div class="attendance-popup-avatar">\n                    <img src="{{=it.avatar}}"/>\n                </div>\n                <div class="attendance-popup-info">\n                    <p>\u7B7E\u5230\u65F6\u95F4\uFF1A{{=moment().format(\'HH:mm:ss\')}}</p>\n                </div>\n            </div>');$('body').append(b(a)),clearTimeout(d),d=setTimeout(function(){$('.attendance-popup').remove()},5e3)}};this.refreshAttendance=function(){var a=Date.now(),b=common.attendanceEvents.filter(function(b){return b.start_time<a});0<b.length?(c.currentEvent=b[b.length-1],$.ajax({url:common.baseUrl+'/classrooms/'+common.classRoom.id+'/attendancesummary?event_id='+c.currentEvent.id,dataType:'json'}).then(function(b){console.log('get attendancesummary',b);var d=doT.template('<div class="attendance-summary">\n            <h3 class="title">{{=it.event_name}}</h3>\n            <p class="info">\u5E94\u5230\u4EBA\u6570&nbsp;{{=it.total}}</p>\n            <p class="info">\u5DF2\u5230&nbsp;{{=it.avail_total}}</p>\n        </div>');if($(c.zonediv).html(d(b.data)),$('#attendanceList').remove(),a<c.currentEvent.end_time){var d=doT.template('<div class="attendance-list" id="attendanceList">\n            {{~it:student:index}}\n            <div class="attendance-item animated" data-id="{{=student.student_id}}">\n                <div class="attendance-avatar">\n                    <img src="{{=student.avatar}}" {{?student.state == \'2\'}}class="opacity"{{?}}/>\n                </div>\n                <div class="attendance-info">\n                    <p>{{=student.student_name}}</p>\n                </div>\n            </div>\n            {{~}}\n        </div>');$('body').append(d(b.data.dtls))}}).catch(function(a){console.log(a.message)})):this.zonediv.html('<div class="attendance-summary">\n            <p>\u5F53\u524D\u65E0\u8003\u52E4</p>\n        </div>')},this.init=function(){setInterval(c.refreshAttendance,3e5),c.refreshAttendance()},this.resize=function(c){a.css({"box-sizing":'border-box',"border-color":b.bdcolor,"border-style":b.bdstyle,"border-width":parseInt(b.bdwidth)/c+'px',"border-radius":parseInt(b.bdradius)/c+'px',color:b.color,"font-family":b.fontfamily,"font-size":parseInt(b.fontsize)/c+'px',"text-align":b.align,"font-weight":b.fontweight,"font-style":b.fontstyle,overflow:'auto'})},this.swipe=function(a){if(c.currentEvent&&c.currentEvent.end_time>Date.now()){var b=common.students.find(function(b){return b.hard_id==a});if(b){e(b);var d=JSON.stringify({event_id:c.currentEvent.id,hard_id:b.hard_id,student_id:b.id,classroom_id:common.classRoom.id,ts:Date.now()});$.ajax({url:common.baseUrl+'/students/'+b.id+'/attendance?event_time='+Date.now(),type:'post',contentType:'application/json',data:d}).then(function(){setTimeout(c.refreshAttendance,1e3)}).catch(function(a){console.log(JSON.stringify(a))})}}}};

//# sourceMappingURL=index.js.map