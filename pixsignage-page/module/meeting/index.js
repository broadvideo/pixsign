'use strict';moment.locale('zh-cn');var Meeting=function(a,b){function c(){if(g.zonediv.parent().addClass('meeting3'),g.isToday){var i='\n                <div class="room-name">'+g.meetingRoom.name+'</div>\n                <div class="current-time">\n                    '+g.current.format('HH:mm')+'\n                </div>\n                <div class="meeting-details"></div>\n                <div class="today-meeting-list"></div>\n                <div class="week-btn"></div>';g.zonediv.addClass('today').removeClass('week'),g.zonediv.html(i),d()}else{var a=5*g.page+1,b=5*g.page+5,c=moment().startOf('day').add(a,'d').format('YYYYMMDDHHmm'),e=moment().endOf('day').add(b,'d').format('YYYYMMDDHHmm'),h={ts:Date.now(),meeting_room_id:g.meetingRoom.meeting_room_id,start_time:c,end_time:e};$.ajax({url:''+g.baseUrl,data:h,dataType:'json'}).then(function(a){g.weekMeetings=a.data;var b='\n                <div class="room-name">'+g.meetingRoom.name+'</div>\n                <div class="current-time">\n                    '+g.current.format('HH:mm')+'\n                </div>\n                <div class="week-meeting-list"></div>\n                <div class="prev-btn"></div>\n                <div class="next-btn"></div>\n                <div class="today-btn"></div>';g.zonediv.addClass('week').removeClass('today'),g.zonediv.html(b),g.hasToday?g.zonediv.addClass('has-today'):(g.zonediv.removeClass('has-today'),g.zonediv.find('.today-btn').remove()),g.page?(g.zonediv.addClass('second-week'),g.zonediv.find('.next-btn').remove()):(g.zonediv.removeClass('second-week'),g.zonediv.find('.prev-btn').remove()),f()})}}function d(){var a=0,b=moment();g.todayMeetings.find(function(c,d){if(b.isBefore(moment(c.end_time)))return a=d,!0});var c={meetings:g.todayMeetings,current:a},d=doT.template('\n            {{~it.meetings:meeting:index}}\n            <div class="meeting-row {{? it.current == index}}current{{?}}" data-id="{{=meeting.meeting_id}}" data-index="{{=index}}">\n                <p class="info"><span class="time">{{=moment(meeting.start_time).format(\'HH:mm\')}}</span><span class="subject">&nbsp;| {{=meeting.subject}}</span></p>\n                <div class="qrcode"><img src="./module/meeting/qrcode.png"/></div>\n            </div>\n            {{~}}');g.zonediv.find('.today-meeting-list').html(''),g.zonediv.find('.today-meeting-list').html(d(c)),g.zonediv.find('.today-meeting-list .meeting-row.current').click()}function e(){g.zonediv.find('.meeting-details').html('');var a=g.zonediv.find('.today-meeting-list .meeting-row.active'),b=a.data('index');a.hasClass('current')?g.zonediv.addClass('current'):g.zonediv.removeClass('current');var c={meeting:g.todayMeetings[b]},d=doT.template('\n            <div><p class="subject">{{=it.meeting.subject}}</p></div>\n            <div class="details">\n                <p class="time">\u8D77\u6B62\u65F6\u95F4\uFF1A{{=moment(it.meeting.start_time).format(\'HH:mm\')}} ~ {{=moment(it.meeting.end_time).format(\'HH:mm\')}}</p>\n                <p class="booker">\u9884\u8BA2\u4EBA\uFF1A{{=it.meeting.book_user}}</p>\n                <p class="attendee">\u53C2\u4F1A\u4EBA\u5458\uFF1A{{~it.meeting.attendees:attendee:index}}{{=attendee.name}} {{~}}</p>\n            </div>');g.zonediv.find('.meeting-details').html(d(c))}function f(){g.zonediv.find('.week-meeting-list').html('');var a=[];console.log(a);for(var c=5*g.page+1,d=5*(g.page+1),e=function(b){var c=moment(),d=c.add(b,'day').format('MM\u6708DD\u65E5'),e=c.format('dddd'),f={date:d,weekday:e};f.meetings=g.weekMeetings.filter(function(a){return moment(a.start_time).isSame(c,'day')}),a.push(f)},f=c;f<=d;f++)e(f);var b=doT.template('\n            {{~it:day:index}}\n            <div class="day-row">\n                <div class="day" data-index="{{=index}}">\n                    <p class="date">{{=day.date}}</p>\n                    <p class="weekday">{{=day.weekday}}</p>\n                </div>\n                <div class="day-meeting-list">\n                    {{? day.meetings.length > 0}}\n                    {{~day.meetings:meeting:index2}}\n                    <div class="day-meeting">\n                        <p class="time">{{=moment(meeting.start_time).format(\'HH:mm\')}}-{{=moment(meeting.end_time).format(\'HH:mm\')}}</p>\n                        <p class="subject">{{=meeting.subject}}</p>\n                        <p class="booker">{{=meeting.book_user}}</p>\n                    </div>\n                    {{~}}\n                    {{??}}\n                    <div class="day-meeting">\n                        <p class="time">\u7A7A\u95F2</p>\n                    </div>\n                    {{?}}\n                </div>\n            </div>\n            {{~}}');g.zonediv.find('.week-meeting-list').html(b(a))}this.zonediv=a,this.zone=b,this.scalew=1,this.scaleh=1,this.host=window.android&&window.android.getHost()||'192.168.0.71',this.baseUrl='http://'+this.host+'/pixmrbs-api/meetings',this.terminalId=window.android&&window.android.getTerminalId()||'zszq00001',this.current=moment(),this.meetingRoom={},this.hasToday=!0,this.isToday=!0,this.page=0,this.todayMeetings=[],this.weekMeetings=[];var g=this;this.resize=function(b,c){g.scalew=b,g.scaleh=c;var d=g.zone.width/(1080*b),e=g.zone.height/(1920*c);$(a).css({transform:'scale('+d+', '+e+')',"transform-origin":'0 0 0'})},setInterval(function(){var a=moment();a.isSame(g.current,'m')||g.zonediv.find('.current-time').html(''+a.format('HH:mm')),g.current=a},1e3),function(){g.zonediv.on('click','.week-btn',function(){g.isToday=!1,g.page=0,c()}),g.zonediv.on('click','.today-btn',function(){g.isToday=!0,c()}),g.zonediv.on('click','.next-btn',function(){g.page=1,c()}),g.zonediv.on('click','.prev-btn',function(){g.page=0,c()}),g.zonediv.on('click','.today-meeting-list .meeting-row',function(){$(this).addClass('active'),$(this).siblings('.meeting-row').removeClass('active'),e()})}(),this.init=function(){$.ajax({url:g.baseUrl+'/meeting_rooms?terminal_id='+g.terminalId+'&ts='+Date.now(),dataType:'json'}).then(function(a){if(g.meetingRoom=a.data,0<a.data.length)g.meetingRoom=a.data[0];else throw new Error('\u672A\u7ED1\u5B9A\u4F1A\u8BAE\u5BA4');var b=moment().startOf('day').format('YYYYMMDDHHmm'),c=moment().endOf('day').format('YYYYMMDDHHmm'),d={ts:Date.now(),meeting_room_id:g.meetingRoom.meeting_room_id,start_time:b,end_time:c};return $.ajax({url:''+g.baseUrl,data:d,dataType:'json'})}).then(function(a){g.todayMeetings=a.data,0<g.todayMeetings.length?g.hasToday=!0:(g.hasToday=!1,g.isToday=!1),c()}).catch(function(a){console.log(a.message)})},this.init(),setInterval(this.init,6e4)};

//# sourceMappingURL=index.js.map