'use strict';moment.locale('zh-cn');var Meeting=function(k,b){function i(){var a=moment(),b='<p>'+a.format('YYYY\u5E74MM\u6708DD\u65E5')+' | '+a.format('HH:mm')+'</p>';l.zonediv.find('.current-time').html(b)}function d(){var b=null;0<l.todayMeetings.length?(b='\n                <div class="room-name"></div>\n                <div class="current-time"></div>\n                <div class="meeting-details"></div>\n                <div class="today-meeting-list"></div>',l.zonediv.addClass('today'),l.zonediv.html(b),e()):(b='\n                <div class="room-name"></div>\n                <div class="current-time"></div>\n                <div class="day-list"></div>\n                <div class="day-meeting-list"></div>',l.zonediv.addClass('week'),l.zonediv.html(b),f());var c='<p>'+l.meetingRoom.name+'</p>';l.zonediv.find('.room-name').html(c),i()}function e(){var d=0,g=moment();l.todayMeetings.find(function(b,c){if(g.isBefore(moment(b.end_time)))return d=c,!0});var c={meetings:l.todayMeetings,current:d},a=doT.template('\n            <table>\n                <tbody>\n                    {{~it.meetings:meeting:index}}\n                    <tr class="{{? it.current == index}}current{{?}}" data-id="{{=meeting.meeting_id}}" data-index="{{=index}}">\n                        <td width="80%">\n                            <p class="info">{{=moment(meeting.start_time).format(\'HH:mm\')}} | {{=meeting.subject}}</p>\n                        </td>\n                        <!--<td width="20%" align="right" class="qrcode"><img src="./qrcode.png"/></td>-->\n                        <td width="20%" align="right" class="qrcode"><img src="./module/meeting/qrcode.png"/></td>\n                    </tr>\n                    {{~}}\n                </tbody>\n            </table>');l.zonediv.find('.today-meeting-list').html(''),l.zonediv.find('.today-meeting-list').html(a(c)),l.zonediv.find('.today-meeting-list tr.current').click()}function c(){l.zonediv.find('.meeting-details').html('');var a=l.zonediv.find('.today-meeting-list tr.active'),c=a.data('index'),e=!1;a.hasClass('current')&&(e=!0);var f={meeting:l.todayMeetings[c],flag:e},g=doT.template('\n            <div class="status"><p><i class="fa fa-group"></i>{{? it.flag}}\u5F53\u524D\u4F1A\u8BAE{{??}}\u4F1A\u8BAE\u9884\u89C8{{?}}</p></div>\n            <div><p class="subject">{{=it.meeting.subject}}</p></div>\n            <div class="details">\n                <p class="time"><i class="fa fa-circle"></i> \u8D77\u6B62\u65F6\u95F4\uFF1A{{=moment(it.meeting.start_time).format(\'HH:mm\')}} ~ {{=moment(it.meeting.end_time).format(\'HH:mm\')}}</p>\n                <p class="booker"><i class="fa fa-circle"></i> \u9884\u8BA2\u4EBA\uFF1A{{=it.meeting.book_user}}</p>\n                <p class="attendee"><i class="fa fa-circle"></i> \u53C2\u4F1A\u4EBA\u5458\uFF1A{{~it.meeting.attendees:attendee:index}}{{=attendee.name}} {{~}}</p>\n            </div>');l.zonediv.find('.meeting-details').html(g(f))}function f(){l.zonediv.find('.day-list').html('');var e=[];console.log(e);for(var a=moment(),b=1;5>=b;b++){var c=a.add(1,'day').format('MM\u6708DD\u65E5'),f=a.format('dddd');e.push({date:c,weekday:f})}var g=doT.template('\n            <div class="status"><i class="fa fa-group"></i><p>\u4ECA\u65E5\u65E0\u4F1A\u8BAE</p></div>\n            <div><p class="title">\u672A\u6765\u4E94\u65E5\u4F1A\u8BAE\u9884\u89C8</p></div>\n            <div class="list">\n                <table>\n                    <tbody>\n                        <tr>\n                            {{~it:day:index}}\n                            <td width="20%" data-index="{{=index}}">\n                                <p>{{=day.date}}</p>\n                                <p>{{=day.weekday}}</p>\n                            </td>\n                            {{~}}\n                        </tr>\n                    </tbody>\n                </table>\n            </div>');l.zonediv.find('.day-list').html(g(e)),l.zonediv.find('.day-list td:first').click()}function g(){var e=l.zonediv.find('.day-list td.active').data('index'),b=moment().add(e+1,'day'),c=l.futureMeetings.filter(function(c){return moment(c.start_time).isSame(b,'day')});if(0<c.length){var f=doT.template('\n            <table>\n                <tbody>\n                    {{~it.meetings:meeting:index}}\n                    <tr data-index="{{=index}}">\n                        <td>\n                            <p class="info">{{=moment(meeting.start_time).format(\'HH:mm\')}} | {{=meeting.subject}}</p>\n                            <div class="details" style="display: none">\n                                <p class="time"><i class="fa fa-circle"></i> \u8D77\u6B62\u65F6\u95F4\uFF1A{{=moment(meeting.start_time).format(\'HH:mm\')}} ~ {{=moment(meeting.end_time).format(\'HH:mm\')}}</p>\n                                <p class="booker"><i class="fa fa-circle"></i> \u9884\u8BA2\u4EBA\uFF1A{{=meeting.book_user}}</p>\n                                <p class="attendee"><i class="fa fa-circle"></i> \u53C2\u4F1A\u4EBA\u5458\uFF1A{{~meeting.attendees:attendee:index2}}{{=attendee.name}} {{~}}</p>\n                            </div>\n                        </td>\n                    </tr>\n                    {{~}}\n                </tbody>\n            </table>');l.zonediv.find('.day-meeting-list').html(f({meetings:c})),l.zonediv.find('.day-meeting-list tr:first').click()}else l.zonediv.find('.day-meeting-list').html('<p class="no-meeting">\u65E0\u4F1A\u8BAE</p>')}this.zonediv=k,this.zone=b,this.scalew=1,this.scaleh=1,this.host=window.android&&window.android.getHost()||'192.168.0.71',this.baseUrl='http://'+this.host+'/pixmrbs-api/meetings',this.terminalId=window.android&&window.android.getTerminalId()||'zszq00001',this.meetingRoom={},this.today=!0,this.meetings=[],this.todayMeetings=[],this.futureMeetings=[];var l=this;this.resize=function(a,b){l.scalew=a,l.scaleh=b;var c=l.zone.width/(1080*a),d=l.zone.height/(1920*b);$(k).css({transform:'scale('+c+', '+d+')',"transform-origin":'0 0 0'})},setInterval(i,5e3),function(){l.zonediv.on('click','.today-meeting-list tr',function(){$(this).addClass('active'),$(this).siblings('tr').removeClass('active'),c()}),l.zonediv.on('click','.day-list td',function(){$(this).addClass('active'),$(this).siblings().removeClass('active'),g()}),l.zonediv.on('click','.day-meeting-list tr',function(){$(this).addClass('active'),$(this).siblings().removeClass('active'),l.zonediv.find('.day-meeting-list .details').css('display','none'),$(this).find('.details').css('display','block')})}(),this.init=function(){$.ajax({url:l.baseUrl+'/meeting_rooms?terminal_id='+l.terminalId+'&ts='+Date.now(),dataType:'json'}).then(function(a){if(l.meetingRoom=a.data,0<a.data.length)l.meetingRoom=a.data[0];else throw new Error('\u672A\u7ED1\u5B9A\u4F1A\u8BAE\u5BA4');var b=moment().startOf('day').format('YYYYMMDDHHmm'),d=moment().endOf('day').add(5,'d').format('YYYYMMDDHHmm'),e={ts:Date.now(),meeting_room_id:l.meetingRoom.meeting_room_id,start_time:b,end_time:d};return $.ajax({url:''+l.baseUrl,data:e,dataType:'json'})}).then(function(a){var b=moment();l.todayMeetings=[],l.futureMeetings=[],a.data.forEach(function(c){moment(c.start_time).isSame(b,'day')?l.todayMeetings.push(c):l.futureMeetings.push(c)}),d()}).catch(function(a){console.log(a.message)})},this.init(),setInterval(this.init,3e5)};

//# sourceMappingURL=index.js.map