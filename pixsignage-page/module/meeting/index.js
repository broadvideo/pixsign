'use strict';moment.locale('zh-cn');var Meeting=function(a,b){function c(){var a=moment();a.isSame(j.current,'m')||j.zonediv.find('.current-time').html(''+a.format('HH:mm')),j.current=a}function d(){var a=null;j.isToday?(a='\n                <div class="room-name">'+j.meetingRoom.name+'</div>\n                <div class="current-time">\n                    '+j.current.format('HH:mm')+'\n                </div>\n                <div class="meeting-details"></div>\n                <div class="today-meeting-list"></div>\n                <div class="week-btn"></div>',j.zonediv.parent().addClass('meeting3'),j.zonediv.addClass('today').removeClass('week'),j.zonediv.html(a),e()):(a='\n                <div class="room-name">'+j.meetingRoom.name+'</div>\n                <div class="current-time">\n                    '+j.current.format('HH:mm')+'\n                </div>\n                <div class="week-meeting-list"></div>\n                <div class="today-btn"></div>',j.zonediv.parent().addClass('meeting3'),j.zonediv.addClass('week').removeClass('today'),j.zonediv.html(a),j.hasToday?(j.zonediv.addClass('has-today'),j.zonediv.find('.today-btn').show()):(j.zonediv.removeClass('has-today'),j.zonediv.find('.today-btn').hide()),g()),c()}function e(){var a=0,b=moment();j.todayMeetings.find(function(c,d){if(b.isBefore(moment(c.end_time)))return a=d,!0});var c={meetings:j.todayMeetings,current:a},d=doT.template('\n            {{~it.meetings:meeting:index}}\n            <div class="meeting-row {{? it.current == index}}current{{?}}" data-id="{{=meeting.meeting_id}}" data-index="{{=index}}">\n                <p class="info"><span class="time">{{=moment(meeting.start_time).format(\'HH:mm\')}}</span><span class="subject">&nbsp;| {{=meeting.subject}}</span></p>\n                <div class="qrcode"><img src="./module/meeting/qrcode.png"/></div>\n            </div>\n            {{~}}');j.zonediv.find('.today-meeting-list').html(''),j.zonediv.find('.today-meeting-list').html(d(c)),j.zonediv.find('.today-meeting-list .meeting-row.current').click()}function f(){j.zonediv.find('.meeting-details').html('');var a=j.zonediv.find('.today-meeting-list .meeting-row.active'),b=a.data('index');a.hasClass('current')?j.zonediv.addClass('current'):j.zonediv.removeClass('current');var c={meeting:j.todayMeetings[b]},d=doT.template('\n            <div><p class="subject">{{=it.meeting.subject}}</p></div>\n            <div class="details">\n                <p class="time">\u8D77\u6B62\u65F6\u95F4\uFF1A{{=moment(it.meeting.start_time).format(\'HH:mm\')}} ~ {{=moment(it.meeting.end_time).format(\'HH:mm\')}}</p>\n                <p class="booker">\u9884\u8BA2\u4EBA\uFF1A{{=it.meeting.book_user}}</p>\n                <p class="attendee">\u53C2\u4F1A\u4EBA\u5458\uFF1A{{~it.meeting.attendees:attendee:index}}{{=attendee.name}} {{~}}</p>\n            </div>');j.zonediv.find('.meeting-details').html(d(c))}function g(){j.zonediv.find('.week-meeting-list').html('');var a=[];console.log(a);for(var c=moment(),d=1;5>=d;d++){var e=c.add(1,'day').format('MM\u6708DD\u65E5'),f=c.format('dddd'),g={date:e,weekday:f};g.meetings=j.weekMeetings.filter(function(a){return moment(a.start_time).isSame(c,'day')}),a.push(g)}var b=doT.template('\n            {{~it:day:index}}\n            <div class="day-row">\n                <div class="day" data-index="{{=index}}">\n                    <p class="date">{{=day.date}}</p>\n                    <p class="weekday">{{=day.weekday}}</p>\n                </div>\n                <div class="day-meeting-list">\n                    {{? day.meetings.length > 0}}\n                    {{~day.meetings:meeting:index2}}\n                    <div class="day-meeting">\n                        <p class="time">{{=moment(meeting.start_time).format(\'HH:mm\')}}-{{=moment(meeting.end_time).format(\'HH:mm\')}}</p>\n                        <p class="subject">{{=meeting.subject}}</p>\n                        <p class="booker">{{=meeting.book_user}}</p>\n                    </div>\n                    {{~}}\n                    {{??}}\n                    <div class="day-meeting">\n                        <p class="time">\u7A7A\u95F2</p>\n                    </div>\n                    {{?}}\n                </div>\n            </div>\n            {{~}}');j.zonediv.find('.week-meeting-list').html(b(a))}function h(){var a=j.zonediv.find('.day-list div.active').data('index'),b=moment().add(a+1,'day'),c=j.weekMeetings.filter(function(a){return moment(a.start_time).isSame(b,'day')});if(0<c.length){j.zonediv.removeClass('no-meeting'),j.zonediv.find('.day-list').removeClass('no-meeting');var d=doT.template('\n            {{~it:meeting:index}}\n            <div class="day-meeting" data-index="{{=index}}" data-id="{{=meeting.meeting_id}}">\n                <div class="info"><span class="time">{{=moment(meeting.start_time).format(\'HH:mm\')}}</span><span class="subject">&nbsp;| {{=meeting.subject}}</span></div>\n            </div>\n            {{~}}');j.zonediv.find('.day-meeting-list').html(d(c)),j.zonediv.find('.day-meeting-list .day-meeting:first').click()}else j.zonediv.addClass('no-meeting'),j.zonediv.find('.day-list').addClass('no-meeting'),j.zonediv.find('.day-meeting-list').html(''),j.zonediv.find('.day-meeting-details').html('')}function i(){var a=j.zonediv.find('.day-meeting-list .day-meeting.active'),b=a.data('id'),c=j.weekMeetings.find(function(a){return a.meeting_id==b});console.log(c);var d=doT.template('\n            <div><p class="subject">{{=it.meeting.subject}}</p></div>\n            <div class="details">\n                <p class="time">\u8D77\u6B62\u65F6\u95F4\uFF1A{{=moment(it.meeting.start_time).format(\'HH:mm\')}} ~ {{=moment(it.meeting.end_time).format(\'HH:mm\')}}</p>\n                <p class="booker">\u9884\u8BA2\u4EBA\uFF1A{{=it.meeting.book_user}}</p>\n                <p class="attendee">\u53C2\u4F1A\u4EBA\u5458\uFF1A{{~it.meeting.attendees:attendee:index}}{{=attendee.name}} {{~}}</p>\n            </div>');j.zonediv.find('.day-meeting-details').html(d({meeting:c}))}this.zonediv=a,this.zone=b,this.scalew=1,this.scaleh=1,this.host=window.android&&window.android.getHost()||'192.168.0.71',this.baseUrl='http://'+this.host+'/pixmrbs-api/meetings',this.terminalId=window.android&&window.android.getTerminalId()||'zszq00001',this.current=moment(),this.meetingRoom={},this.hasToday=!1,this.isToday=!1,this.todayMeetings=[],this.weekMeetings=[];var j=this;this.resize=function(b,c){j.scalew=b,j.scaleh=c;var d=j.zone.width/(1080*b),e=j.zone.height/(1920*c);$(a).css({transform:'scale('+d+', '+e+')',"transform-origin":'0 0 0'})},setInterval(c,1e3),function(){j.zonediv.on('click','.week-btn',function(){j.isToday=!1,d()}),j.zonediv.on('click','.today-btn',function(){j.isToday=!0,d()}),j.zonediv.on('click','.today-meeting-list .meeting-row',function(){$(this).addClass('active'),$(this).siblings('.meeting-row').removeClass('active'),f()}),j.zonediv.on('click','.day-list>div',function(){$(this).addClass('active'),$(this).siblings().removeClass('active'),h()}),j.zonediv.on('click','.day-meeting',function(){$(this).addClass('active'),$(this).siblings().removeClass('active'),i()})}(),this.init=function(){$.ajax({url:j.baseUrl+'/meeting_rooms?terminal_id='+j.terminalId+'&ts='+Date.now(),dataType:'json'}).then(function(a){if(j.meetingRoom=a.data,0<a.data.length)j.meetingRoom=a.data[0];else throw new Error('\u672A\u7ED1\u5B9A\u4F1A\u8BAE\u5BA4');var b=moment().startOf('day').format('YYYYMMDDHHmm'),c=moment().endOf('day').add(5,'d').format('YYYYMMDDHHmm'),d={ts:Date.now(),meeting_room_id:j.meetingRoom.meeting_room_id,start_time:b,end_time:c};return $.ajax({url:''+j.baseUrl,data:d,dataType:'json'})}).then(function(a){var b=moment();j.todayMeetings=[],j.weekMeetings=[],a.data.forEach(function(a){moment(a.start_time).isSame(b,'day')?j.todayMeetings.push(a):j.weekMeetings.push(a)}),0<j.todayMeetings.length?(j.hasToday=!0,j.isToday=!0):(j.hasToday=!1,j.isToday=!1),d()}).catch(function(a){console.log(a.message)})},this.init(),setInterval(this.init,3e5)};

//# sourceMappingURL=index.js.map