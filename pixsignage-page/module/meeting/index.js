'use strict';moment.locale('zh-cn');var Meeting=function(j,i){function a(){var a=moment();a.isSame(l.current,'m')||l.zonediv.find('.current-time').html(a.format('YYYY\u5E74MM\u6708DD\u65E5')+'&nbsp;&nbsp;'+a.format('HH:mm')),l.current=a}function b(){var b=null;l.isToday?(b='\n                <div class="room-name">'+l.meetingRoom.name+'</div>\n                <div class="current-time">\n                    '+l.current.format('YYYY\u5E74MM\u6708DD\u65E5')+'&nbsp;&nbsp;'+l.current.format('HH:mm')+'\n                </div>\n                <div class="meeting-details"></div>\n                <div class="today-meeting-list"></div>\n                <div class="week-btn"></div>',l.zonediv.addClass('today').removeClass('week'),l.zonediv.html(b),k()):(b='\n                <div class="room-name">'+l.meetingRoom.name+'</div>\n                <div class="current-time">\n                    '+l.current.format('YYYY\u5E74MM\u6708DD\u65E5')+'&nbsp;&nbsp;'+l.current.format('HH:mm')+'\n                </div>\n                <div class="day-list"></div>\n                <div class="day-meeting-list"></div>\n                <div class="today-btn"></div>',l.zonediv.addClass('week').removeClass('today'),l.zonediv.html(b),l.hasToday?(l.zonediv.addClass('has-today'),l.zonediv.find('.today-btn').show()):(l.zonediv.removeClass('has-today'),l.zonediv.find('.today-btn').hide()),d()),a()}function k(){var d=0,g=moment();l.todayMeetings.find(function(c,a){if(g.isBefore(moment(c.end_time)))return d=a,!0});var a={meetings:l.todayMeetings,current:d},b=doT.template('\n            {{~it.meetings:meeting:index}}\n            <div class="meeting-row {{? it.current == index}}current{{?}}" data-id="{{=meeting.meeting_id}}" data-index="{{=index}}">\n                <p class="info"><span class="time">{{=moment(meeting.start_time).format(\'HH:mm\')}}</span><span class="subject">&nbsp;| {{=meeting.subject}}</span></p>\n                <div class="qrcode"><img src="./module/meeting/qrcode.png"/></div>\n            </div>\n            {{~}}');l.zonediv.find('.today-meeting-list').html(''),l.zonediv.find('.today-meeting-list').html(b(a)),l.zonediv.find('.today-meeting-list .meeting-row.current').click()}function c(){l.zonediv.find('.meeting-details').html('');var d=l.zonediv.find('.today-meeting-list .meeting-row.active'),f=d.data('index');d.hasClass('current')?l.zonediv.addClass('current'):l.zonediv.removeClass('current');var a={meeting:l.todayMeetings[f]},b=doT.template('\n            <div><p class="subject">{{=it.meeting.subject}}</p></div>\n            <div class="details">\n                <p class="time">\u8D77\u6B62\u65F6\u95F4\uFF1A{{=moment(it.meeting.start_time).format(\'HH:mm\')}} ~ {{=moment(it.meeting.end_time).format(\'HH:mm\')}}</p>\n                <p class="booker">\u9884\u8BA2\u4EBA\uFF1A{{=it.meeting.book_user}}</p>\n                <p class="attendee">\u53C2\u4F1A\u4EBA\u5458\uFF1A{{~it.meeting.attendees:attendee:index}}{{=attendee.name}} {{~}}</p>\n            </div>');l.zonediv.find('.meeting-details').html(b(a))}function d(){l.zonediv.find('.day-list').html('');var b=[];console.log(b);for(var e=moment(),a=1;5>=a;a++){var c=e.add(1,'day').format('MM\u6708DD\u65E5'),f=e.format('dddd');b.push({date:c,weekday:f})}var g=doT.template('\n            {{~it:day:index}}\n            <div class="day" width="20%" data-index="{{=index}}">\n                <p class="date">{{=day.date}}</p>\n                <p class="weekday">{{=day.weekday}}</p>\n            </div>\n            {{~}}');l.zonediv.find('.day-list').html(g(b)),l.zonediv.find('.day-list>div:first').click()}function e(){var c=l.zonediv.find('.day-list div.active').data('index'),d=moment().add(c+1,'day'),e=l.weekMeetings.filter(function(a){return moment(a.start_time).isSame(d,'day')});if(0<e.length){var a=doT.template('\n            {{~it:meeting:index}}\n            <div class="day-meeting" data-index="{{=index}}">\n                <div class="info"><span class="time">{{=moment(meeting.start_time).format(\'HH:mm\')}}</span><span class="subject">&nbsp;| {{=meeting.subject}}</span></div>\n                <div class="details">\n                    <p class="time">\u8D77\u6B62\u65F6\u95F4\uFF1A{{=moment(meeting.start_time).format(\'HH:mm\')}} ~ {{=moment(meeting.end_time).format(\'HH:mm\')}}</p>\n                    <p class="booker">\u9884\u8BA2\u4EBA\uFF1A{{=meeting.book_user}}</p>\n                    <p class="attendee">\u53C2\u4F1A\u4EBA\u5458\uFF1A{{~meeting.attendees:attendee:index2}}{{=attendee.name}} {{~}}</p>\n                </div>\n            </div>\n            {{~}}');l.zonediv.find('.day-meeting-list').html(a(e)),l.zonediv.find('.day-meeting-list .day-meeting:first').click()}else l.zonediv.find('.day-meeting-list').html('<p class="no-meeting">\u65E0\u4F1A\u8BAE</p>')}this.zonediv=j,this.zone=i,this.scalew=1,this.scaleh=1,this.host=window.android&&window.android.getHost()||'192.168.0.71',this.baseUrl='http://'+this.host+'/pixmrbs-api/meetings',this.terminalId=window.android&&window.android.getTerminalId()||'zszq00001',this.current=moment(),this.meetingRoom={},this.hasToday=!1,this.isToday=!1,this.isCurrent=!1,this.todayMeetings=[],this.weekMeetings=[];var l=this;this.resize=function(e,a){l.scalew=e,l.scaleh=a;var b=l.zone.width/(1080*e),c=l.zone.height/(1920*a);$(j).css({transform:'scale('+b+', '+c+')',"transform-origin":'0 0 0'})},setInterval(a,1e3),function(){l.zonediv.on('click','.week-btn',function(){l.isToday=!1,b()}),l.zonediv.on('click','.today-btn',function(){l.isToday=!0,b()}),l.zonediv.on('click','.today-meeting-list .meeting-row',function(){$(this).addClass('active'),$(this).siblings('.meeting-row').removeClass('active'),c()}),l.zonediv.on('click','.day-list>div',function(){$(this).addClass('active'),$(this).siblings().removeClass('active'),e()}),l.zonediv.on('click','.day-meeting',function(){$(this).addClass('active'),$(this).siblings().removeClass('active')})}(),this.init=function(){$.ajax({url:l.baseUrl+'/meeting_rooms?terminal_id='+l.terminalId+'&ts='+Date.now(),dataType:'json'}).then(function(b){if(l.meetingRoom=b.data,0<b.data.length)l.meetingRoom=b.data[0];else throw new Error('\u672A\u7ED1\u5B9A\u4F1A\u8BAE\u5BA4');var c=moment().startOf('day').format('YYYYMMDDHHmm'),d=moment().endOf('day').add(5,'d').format('YYYYMMDDHHmm'),e={ts:Date.now(),meeting_room_id:l.meetingRoom.meeting_room_id,start_time:c,end_time:d};return $.ajax({url:''+l.baseUrl,data:e,dataType:'json'})}).then(function(a){var c=moment();l.todayMeetings=[],l.weekMeetings=[],a.data.forEach(function(a){moment(a.start_time).isSame(c,'day')?l.todayMeetings.push(a):l.weekMeetings.push(a)}),0<l.todayMeetings.length?(l.hasToday=!0,l.isToday=!0):(l.hasToday=!1,l.isToday=!1),b()}).catch(function(a){console.log(a.message)})},this.init(),setInterval(this.init,3e5)};

//# sourceMappingURL=index.js.map