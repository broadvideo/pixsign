{"version":3,"sources":["meeting.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["//日历初始化\r\nvar Meeting = function (zonediv, zone) {\r\n    this.zonediv = zonediv;\r\n    this.zone = zone;\r\n    this.scalew = 1;\r\n    this.scaleh = 1;\r\n    this.host = window.android && window.android.getHost() || '192.168.0.102:8080';\r\n    this.baseUrl = 'http://' + this.host + '/pixmrbs-api/meetings';\r\n    this.terminalId = window.android && window.android.getTerminalId() || '00001';\r\n    this.meetingRoom = {};\r\n    this.meetings = [];\r\n\r\n    var meetingTpl = `\r\n        <table>\r\n            <tbody>\r\n            {{~it:meeting:index}}\r\n            <tr class=\"meeting\" data-id=\"{{=meeting.id}}\">\r\n                <td width=\"20%\">\r\n                <p class=\"time\"><i class=\"fa fa-star\"></i> {{=moment(meeting.start_time).format('HH:mm')}} - {{=moment(meeting.end_time).format('HH:mm')}}</p>\r\n                <p class=\"booker\">{{=meeting.book_user}}</p>\r\n                </td>\r\n                <td width=\"60%\">\r\n                <p class=\"title\">{{=meeting.subject}}</p>\r\n                <p>&nbsp;</p>\r\n                </td>\r\n                <td width=\"20%\" align=\"right\"><img src=\"./module/meeting/qrcode.png\" /></td>\r\n            </tr>\r\n            {{~}}\r\n            </tbody>\r\n        </table>`\r\n\r\n    var detailTpl = `<div class=\"modal\" id=\"meeting-detail\">\r\n        <h1>{{=it.title}}</h1>\r\n        <p>时间： {{=it.start_time}} - {{=it.end_time}}</p>\r\n        <p>部门： {{=it.department}}</p>\r\n        <p>人员： {{=it.attendee}}</p>\r\n        <p>预定人： {{=it.booker}}</p>\r\n        <img src=\"./module/meeting/qrcode.png\"/>\r\n        <a href=\"#close-modal\" rel=\"modal:close\" class=\"close-modal \">Close</a></div>`\r\n\r\n    this.resize = function (scalew, scaleh) {\r\n        this.scalew = scalew\r\n        this.scaleh = scaleh\r\n        $(zonediv).css({\r\n            'box-sizing': 'border-box',\r\n            'border-color': zone.bdcolor,\r\n            'border-style': zone.bdstyle,\r\n            'border-width': (parseInt(zone.bdwidth) / scalew) + 'px',\r\n            'border-radius': (parseInt(zone.bdradius) / scalew) + 'px',\r\n            'color': zone.color,\r\n            'font-family': zone.fontfamily,\r\n            'font-size': (parseInt(zone.fontsize) / scalew) + 'px',\r\n            'text-align': zone.align,\r\n            'font-weight': zone.fontweight,\r\n            'font-style': zone.fontstyle,\r\n            'line-height': '1px'\r\n        });\r\n        var lineHeight = Math.ceil(zone.height / (zone.rows * scaleh * 2))\r\n        var fontsize = zone.fontsize / scaleh\r\n        $(zonediv).find('p').css({\r\n            'line-height': lineHeight - 3 + 'px',\r\n            'text-align': zone.align,\r\n            'font-size': fontsize + 'px',\r\n            'text-overflow': 'ellipsis',\r\n            overflow: 'hidden',\r\n            'white-space': 'nowrap',\r\n            margin: 0\r\n        });\r\n        $(zonediv).find('img').css({\r\n            'height': 1.4 * lineHeight + 'px',\r\n            'text-align': zone.align\r\n        });\r\n    };\r\n\r\n    // 数据初始化\r\n    this.init = function () {\r\n        var thiz = this\r\n        $.ajax({\r\n            url: `${thiz.baseUrl}/meeting_rooms?terminal_id=${thiz.terminalId}&ts=${Date.now()}`,\r\n            dataType: 'json'\r\n        }).then(function (res) {\r\n            thiz.meetingRoom = res.data;\r\n            if (res.data.length > 0) thiz.meetingRoom = res.data[0]\r\n            else throw new Error('未绑定会议室')\r\n            var start_time = moment().startOf('day').format('YYYYMMDDHHmm')\r\n            var end_time = moment().endOf('day').format('YYYYMMDDHHmm')\r\n            var data = {\r\n                ts: Date.now(),\r\n                meeting_room_id: thiz.meetingRoom.meeting_room_id,\r\n                start_time: start_time,\r\n                end_time: end_time\r\n            }\r\n            return $.ajax({\r\n                url: `${thiz.baseUrl}`,\r\n                data: data,\r\n                dataType: 'json'\r\n            });\r\n        }).then(function (res) {\r\n            thiz.meetings = res.data;\r\n            var templ = doT.template(meetingTpl)\r\n            thiz.zonediv.html(templ(thiz.meetings))\r\n            thiz.resize(thiz.scalew, thiz.scaleh)\r\n        }).catch(function (err) {\r\n            console.log(err.message);\r\n        });\r\n        $(thiz.zonediv).on('click', '.meeting', function (ev) {\r\n            ev.preventDefault()\r\n            $('#meeting-detail').remove()\r\n            var id = $(this).data('id')\r\n            var meeting = meetings[id - 1]\r\n            var dtlTpl = doT.template(detailTpl)\r\n            $(document.body).append(dtlTpl(meeting))\r\n            $('#meeting-detail').modal()\r\n            $('#meeting-detail').css('z-index', 500)\r\n        })\r\n    }\r\n\r\n    this.init()\r\n    //周期性更新数据\r\n    setTimeout(this.init, 300000)\r\n};\r\n"]}