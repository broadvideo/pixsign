'use strict';var Attendance=function(d,e){this.zonediv=d,this.zone=e,this.currentEvent=null,common.attendance.push(this);var f=0,b=function(a){if(a.id){$('.attendance-item').each(function(b,c){$(c).data('id')==a.id&&($(c).find('img').removeClass('opacity'),$(c).addClass('rubberBand'),setTimeout(function(){$(c).removeClass('rubberBand')},1e3))}),$('.attendance-popup').remove();var b=doT.template('<div class="attendance-popup animated" data-id="{{=it.id}}">\n                <div class="attendance-popup-avatar">\n                    <img src="{{=it.avatar}}"/>\n                </div>\n                <div class="attendance-popup-info">\n                    <p>\u7B7E\u5230\u65F6\u95F4\uFF1A{{=moment().format(\'HH:mm:ss\')}}</p>\n                </div>\n            </div>');$('body').append(b(a)),clearTimeout(f),f=setTimeout(function(){$('.attendance-popup').remove()},5e3)}};this.refreshAttendance=function(){var e=this,f=Date.now(),b=common.attendanceEvents.filter(function(a){return a.start_time<f});0<b.length?(e.currentEvent=b[b.length-1],$.ajax({url:common.baseUrl+'/classrooms/'+common.classRoom.id+'/attendancesummary?event_id='+e.currentEvent.id,dataType:'json'}).then(function(a){console.log('get attendancesummary',a);var b=doT.template('<div class="attendance-summary">\n            <h3 class="title">{{=it.event_name}}</h3>\n            <p class="info">\u5E94\u5230\u4EBA\u6570&nbsp;{{=it.total}}</p>\n            <p class="info">\u5DF2\u5230&nbsp;{{=it.avail_total}}</p>\n        </div>');if($(e.zonediv).html(b(a.data)),$('#attendanceList').remove(),f<e.currentEvent.end_time){var b=doT.template('<div class="attendance-list" id="attendanceList">\n            {{~it:student:index}}\n            <div class="attendance-item animated" data-id="{{=student.student_id}}">\n                <div class="attendance-avatar">\n                    <img src="{{=student.avatar}}" {{?student.state == \'2\'}}class="opacity"{{?}}/>\n                </div>\n                <div class="attendance-info">\n                    <p>{{=student.student_name}}</p>\n                </div>\n            </div>\n            {{~}}\n        </div>');$('body').append(b(a.data.dtls))}}).catch(function(a){console.log(a.message)})):this.zonediv.html('<div class="attendance-summary">\n            <p>\u5F53\u524D\u65E0\u8003\u52E4</p>\n        </div>')},this.init=function(){var a=this;setInterval(a.refreshAttendance,3e5),a.refreshAttendance()},this.resize=function(a){d.css({"box-sizing":'border-box',"border-color":e.bdcolor,"border-style":e.bdstyle,"border-width":parseInt(e.bdwidth)/a+'px',"border-radius":parseInt(e.bdradius)/a+'px',color:e.color,"font-family":e.fontfamily,"font-size":parseInt(e.fontsize)/a+'px',"text-align":e.align,"font-weight":e.fontweight,"font-style":e.fontstyle,overflow:'auto'})},this.swipe=function(f){var c=this;if(c.currentEvent&&c.currentEvent.end_time>Date.now()){var e=common.students.find(function(b){return b.hard_id==f});if(e){b(e);var d=JSON.stringify({event_id:c.currentEvent.id,hard_id:e.hard_id,student_id:e.id,classroom_id:common.classRoom.id,ts:Date.now()});$.ajax({url:common.baseUrl+'/students/'+e.id+'/attendance?event_time='+Date.now(),type:'post',contentType:'application/json',data:d}).then(function(){setTimeout(c.refreshAttendance,1e3)}).catch(function(a){console.log(JSON.stringify(a))})}}}};

//# sourceMappingURL=index.js.map