'use strict';var HomeSchool=function(g,b){this.zonediv=g,this.zone=b,common.homeSchool.push(this);var e={},c='<div class="home-school-popup">\n            <div style="padding: 0 5px;">\n                <span class="home-school-close"><i class="fa fa-times"></i></span>\n                <p class="home-school-title">\u6D88\u606F\u5217\u8868</p>\n            </div>\n            <hr style="margin: 0">\n            <table class="home-school-table">\n                <tbody>\n                {{~it:message:index}}\n                <tr class="home-school-tr">\n                    <td class="home-school-avatar">\n                        <img src="{{=message.headimgurl}}"/>\n                    </td>\n                    <td class="home-school-name">\n                        <span>{{=message.name}}</span>\n                    </td>\n                    <td class="home-school-message">\n                        {{? message.message_info}}\n                        <span>{{=message.message_info}}</span>\n                        {{?}}\n                        {{? message.mp3_file}}\n                        <audio src="{{=message.mp3_file}}" controls=controls></audio>\n                        {{?}}\n                    </td>\n                    <td class="home-school-ts">\n                        <span>{{=message.send_time}}</span>\n                    </td>\n                </tr>\n                {{~}}\n                </tbody>\n            </table>\n            <hr style="margin: 0">\n            <div style="padding:0 5px">\n                <span class="home-school-audio"><i class="fa fa-bullhorn"></i></span>\n            </div>\n        </div>',d=function(){$.ajax({url:common.baseUrl+'/classrooms/'+common.classRoom.id+'/messagesum?ts='+Date.now(),dataType:'text'}).then(function(d){console.log(JSON.stringify(d));var e=Base64.decode(d),a=JSON.parse(e);console.log(a),a.forEach(function(a){common.students.forEach(function(b){b.student_no===a.student_no&&(a.avatar=b.avatar)})});var b=doT.template('<table class="home-school-table">\n            <tbody>\n            {{? it.length == 0}}\n            \u65E0\u7559\u8A00\u8BB0\u5F55\n            {{?}}\n            {{~it:msgSum:index}}\n            <tr class="home-school-tr">\n                <td class="home-school-avatar">\n                    <img src="{{=msgSum.avatar}}"/>\n                </td>\n                <td class="home-school-name">\n                    <span>{{=msgSum.student_name}}</span>\n                </td>\n                <td class="home-school-sum">\n                    <span>{{=msgSum.num}}</span>\n                </td>\n            </tr>\n            {{~}}\n            </tbody>\n        </table>');$(g).html(b(a))}).catch(function(b){console.log(JSON.stringify(b))})};this.init=function(){d(),setInterval(d,5e3),$('body').on('click','.home-school-close',function(){$('.home-school-popup').remove()}),$('body').on('click','.home-school-audio',function(a){if(a.preventDefault(),console.log('recording button is clicked'),$(this).hasClass('recording')){$(this).removeClass('recording');var b=window.android.closeVoiceRecorder(),d={student_id:e.id,text:'',audio:b,msg_time:Date.now()};$.ajax({url:common.baseUrl+'/students/'+e.id+'/message?ts='+Date.now(),type:'POST',cache:!1,data:JSON.stringify(d),contentType:'application/json',dataType:'json'}).then(function(){console.log('send message successfully')}).catch(function(b){console.log(JSON.stringify(b))})}else $(this).addClass('recording'),window.android.openVoiceRecorder()})},this.resize=function(c){g.css({"box-sizing":'border-box',"border-color":b.bdcolor,"border-style":b.bdstyle,"border-width":parseInt(b.bdwidth)/c+'px',"border-radius":parseInt(b.bdradius)/c+'px',color:b.color,"font-family":b.fontfamily,"font-size":parseInt(b.fontsize)/c+'px',"text-align":b.align,"font-weight":b.fontweight,"font-style":b.fontstyle})},this.swipe=function(a){var b=common.students.filter(function(b){return b.hard_id==a});b.length&&(e=b[0],$.ajax({url:common.baseUrl+'/students/'+e.id+'/messages?ts='+Date.now(),dataType:'text'}).then(function(f){var e=Base64.decode(f),d=JSON.parse(e);$('.home-school-popup').remove();var a=doT.template(c);$(document.body).append(a(d))}).catch(function(b){console.log(b)}))},this.keyup=function(){e=common.students[Math.floor(10*Math.random())],$.ajax({url:common.baseUrl+'/students/18/messages?ts='+Date.now(),dataType:'text'}).then(function(f){var e=Base64.decode(f),d=JSON.parse(e);console.log(d),$('.home-school-popup').remove();var a=doT.template(c);$(document.body).append(a(d))}).catch(function(b){console.log(b)})}};

//# sourceMappingURL=index.js.map