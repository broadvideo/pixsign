'use strict';var Attendance=function(c,d){this.zonediv=c,this.zone=d,this.currentEvent=null,common.attendance.push(this);var b=0,e=function(c){if(c.id){$('.attendance-item').each(function(d,a){$(a).data('id')==c.id&&($(a).find('img').removeClass('opacity'),$(a).addClass('rubberBand'),setTimeout(function(){$(a).removeClass('rubberBand')},1e3))}),$('.attendance-popup').remove();var d=doT.template('<div class="attendance-popup animated" data-id="{{=it.id}}">\n                <div class="attendance-popup-avatar">\n                    <img src="{{=it.avatar}}"/>\n                </div>\n                <div class="attendance-popup-info">\n                    <p>\u7B7E\u5230\u65F6\u95F4\uFF1A{{=moment().format(\'HH:mm:ss\')}}</p>\n                </div>\n            </div>');$('body').append(d(c)),clearTimeout(b),b=setTimeout(function(){$('.attendance-popup').remove()},5e3)}};this.refreshAttendance=function(){var c=this,d=Date.now(),b=common.attendanceEvents.filter(function(a){return a.start_time<d});0<b.length?(c.currentEvent=b[b.length-1],$.ajax({url:common.baseUrl+'/classrooms/'+common.classRoom.id+'/attendancesummary?event_id='+c.currentEvent.id,dataType:'json'}).then(function(e){console.log('get attendancesummary',e);var a=doT.template('<div class="attendance-summary">\n            <h3 class="title">{{=it.event_name}}</h3>\n            <p class="info">\u5E94\u5230\u4EBA\u6570&nbsp;{{=it.total}}</p>\n            <p class="info">\u5DF2\u5230&nbsp;{{=it.avail_total}}</p>\n        </div>');if($(c.zonediv).html(a(e.data)),$('#attendanceList').remove(),d<c.currentEvent.end_time){var a=doT.template('<div class="attendance-list" id="attendanceList">\n            {{~it:student:index}}\n            <div class="attendance-item animated" data-id="{{=student.student_id}}">\n                <div class="attendance-avatar">\n                    <img src="{{=student.avatar}}" {{?student.state == \'2\'}}class="opacity"{{?}}/>\n                </div>\n                <div class="attendance-info">\n                    <p>{{=student.student_name}}</p>\n                </div>\n            </div>\n            {{~}}\n        </div>');$('body').append(a(e.data.dtls))}}).catch(function(a){console.log(a.message)})):this.zonediv.html('<div class="attendance-summary">\n            <p>\u5F53\u524D\u65E0\u8003\u52E4</p>\n        </div>')},this.init=function(){var a=this;setInterval(a.refreshAttendance,3e5),a.refreshAttendance()},this.resize=function(a){c.css({"box-sizing":'border-box',"border-color":d.bdcolor,"border-style":d.bdstyle,"border-width":parseInt(d.bdwidth)/a+'px',"border-radius":parseInt(d.bdradius)/a+'px',color:d.color,"font-family":d.fontfamily,"font-size":parseInt(d.fontsize)/a+'px',"text-align":d.align,"font-weight":d.fontweight,"font-style":d.fontstyle,overflow:'auto'})},this.swipe=function(f){var d=this;if(d.currentEvent&&d.currentEvent.end_time<Date.now){var a=common.students.find(function(b){return b.hard_id==f});if(a){e(a);var b=JSON.stringify({hard_id:a.hard_id,student_id:a.id,classroom_id:common.classRoom.id,ts:Date.now()});$.ajax({url:common.baseUrl+'/students/'+a.id+'/attendance?event_time='+Date.now()+'&event_id='+d.currentEvent.id,type:'post',contentType:'application/json',data:b}).then(function(){d.refreshAttendance()}).catch(function(a){console.log(JSON.stringify(a))})}}}};

//# sourceMappingURL=index.js.map