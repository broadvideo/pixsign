{"version":3,"sources":["weekly-course.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["//日历初始化\r\nvar WeeklyCourse = function (zonediv, zone, scalew, scaleh) {\r\n    this.zonediv = zonediv;\r\n    this.zone = zone;\r\n    var host = window.android && window.android.getHost() || '192.168.0.71'\r\n    var baseUrl = 'http://' + host + '/pixsignage-api/service'\r\n    var terminalId = window.android && window.android.getTerminalId() || '00004'\r\n    var classRoom = {}\r\n    var timer, current = moment()\r\n    $.ajaxSetup({\r\n        global: true,\r\n        cache: false\r\n    })\r\n    var WeeklyCourseTpl = `<table>\r\n            <tbody>\r\n            <tr>\r\n                <td>时间</td>\r\n                {{~it.scheme.workdays:day:index}}\r\n                <td>{{=day.dayname}}</td>\r\n                {{~}}\r\n            </tr>\r\n            {{~it.scheme.morning.dtls:courseIndex:index}}\r\n            <tr>\r\n                <td><span>{{=courseIndex.courseName}}</span><span>{{=courseIndex.start_time}}</span></td>\r\n                {{~it.scheme.workdays:day:index2}}\r\n                <td data-periodnum=\"{{=index}}\" data-type=\"0\" data-workday=\"{{=index2}}\"> </td>\r\n                {{~}}\r\n            </tr>\r\n            {{~}}\r\n            <tr><td colspan=\"{{=it.cols}}\"> </td></tr>\r\n            {{~it.scheme.afternoon.dtls:courseIndex:index}}\r\n            <tr>\r\n                <td><span>{{=courseIndex.courseName}}</span><span>{{=courseIndex.start_time}}</span></td>\r\n                {{~it.scheme.workdays:day:index2}}\r\n                <td data-periodnum=\"{{=index}}\" data-type=\"2\" data-workday=\"{{=index2}}\"> </td>\r\n                {{~}}\r\n            </tr>\r\n            {{~}}\r\n            <tr></tr>\r\n            {{~it.scheme.night.dtls:courseIndex:index}}\r\n            <tr>\r\n                <td><span>{{=courseIndex.courseName}}</span><span>{{=courseIndex.start_time}}</span></td>\r\n                {{~it.scheme.workdays:day:index2}}\r\n                <td data-periodnum=\"{{=index}}\" data-type=\"3\" data-workday=\"{{=index2}}\"> </td>\r\n                {{~}}\r\n            </tr>\r\n            {{~}}\r\n            </tbody>\r\n        </table>`\r\n\r\n    this.resize = function (scalew, scaleh) {\r\n        let thiz = this\r\n        zonediv.css({\r\n            'box-sizing': 'border-box',\r\n            'border-color': zone.bdcolor,\r\n            'border-style': zone.bdstyle,\r\n            'border-width': (parseInt(zone.bdwidth) / scalew) + 'px',\r\n            'border-radius': (parseInt(zone.bdradius) / scalew) + 'px',\r\n            'color': zone.color,\r\n            'font-family': zone.fontfamily,\r\n            'font-size': (parseInt(zone.fontsize) / scalew) + 'px',\r\n            'text-align': zone.align,\r\n            'font-weight': zone.fontweight,\r\n            'font-style': zone.fontstyle,\r\n        });\r\n        zonediv.find('table').css({'table-layout': 'fixed'})\r\n        zonediv.find('td').css({\r\n            'border-width': Math.ceil(zone.rulewidth / scalew) + 'px',\r\n            'border-color': zone.rulecolor,\r\n            'word-wrap': 'break-word',\r\n            'white-space': 'pre-wrap',\r\n            'text-decoration': zone.decoration,\r\n            'height': thiz.zonediv.height() / zone.rows - Math.ceil(zone.rulewidth / scalew),\r\n        });\r\n    };\r\n\r\n    // 数据初始化\r\n    this.init = function () {\r\n        var thiz = this\r\n        $.ajax({\r\n            url: baseUrl + '/terminals/' + terminalId + '/classroom',\r\n            dataType: 'json'\r\n        }).then(function (res) {\r\n            classRoom = res.classroom\r\n            return $.ajax({\r\n                url: baseUrl + '/classrooms/' + classRoom.id + '/schedules',\r\n                contentType: 'application/json; charset=UTF-8',\r\n                dataType: 'json',\r\n            })\r\n        }).then(function (res) {\r\n            if (res.retcode != 0) throw new Error('failed to get day course list.');\r\n            res.course_schedules.forEach(function (item) {\r\n                if (moment().format('E') == item.workday && moment(item['start_time'], 'HH:mm').isBefore(moment()) && moment(item['end_time'], 'HH:mm').isAfter(moment())) {\r\n                    item.current = true\r\n                }\r\n                else {\r\n                    item.current = false\r\n                }\r\n            });\r\n            res.scheme.workdays = res.scheme.workdays.map(item => {\r\n                switch (item) {\r\n                    case 1:\r\n                        return {index: item, dayname: '星期一'}\r\n                    case 2:\r\n                        return {index: item, dayname: '星期二'}\r\n                    case 3:\r\n                        return {index: item, dayname: '星期三'}\r\n                    case 4:\r\n                        return {index: item, dayname: '星期四'}\r\n                    case 5:\r\n                        return {index: item, dayname: '星期五'}\r\n                    case 6:\r\n                        return {index: item, dayname: '星期六'}\r\n                    case 7:\r\n                        return {index: item, dayname: '星期天'}\r\n                }\r\n            }).slice(0, thiz.zone.cols - 1)\r\n            res.scheme.morning.dtls.forEach(item => {\r\n                switch (item.period_num) {\r\n                    case 1:\r\n                        item.courseName = '第一节'\r\n                        break;\r\n                    case 2:\r\n                        item.courseName = '第二节'\r\n                        break;\r\n                    case 3:\r\n                        item.courseName = '第三节'\r\n                        break;\r\n                    case 4:\r\n                        item.courseName = '第四节'\r\n                        break;\r\n                }\r\n            })\r\n            res.scheme.afternoon.dtls.forEach(item => {\r\n                switch (item.period_num) {\r\n                    case 1:\r\n                        item.courseName = '第一节'\r\n                        break;\r\n                    case 2:\r\n                        item.courseName = '第二节'\r\n                        break;\r\n                    case 3:\r\n                        item.courseName = '第三节'\r\n                        break;\r\n                    case 4:\r\n                        item.courseName = '第四节'\r\n                        break;\r\n                }\r\n            })\r\n            res.scheme.night.dtls.forEach(item => {\r\n                switch (item.period_num) {\r\n                    case 1:\r\n                        item.courseName = '第一节'\r\n                        break;\r\n                    case 2:\r\n                        item.courseName = '第二节'\r\n                        break;\r\n                    case 3:\r\n                        item.courseName = '第三节'\r\n                        break;\r\n                    case 4:\r\n                        item.courseName = '第四节'\r\n                        break;\r\n                }\r\n            })\r\n            res.cols = thiz.zone.cols\r\n            var templ = doT.template(WeeklyCourseTpl)\r\n            thiz.zonediv.html(templ(res))\r\n            res.course_schedules.forEach(item => {\r\n                thiz.zonediv.find('td').each(function (i, item2) {\r\n                    if ($(item2).data('periodnum') == item['period_num'] && $(item2).data('type') == item['type'] && $(item2).data('workday') == item['workday']) {\r\n                        $(item2).html(`<span>${item.course_name}</span><span>(${item.teacher_name})</span>`)\r\n                    }\r\n                })\r\n            })\r\n            thiz.zonediv.find('tr').each(function (index, item) {\r\n                if (index >= thiz.zone.rows) {\r\n                    $(item).remove()\r\n                }\r\n            })\r\n            thiz.zonediv.find('table').css({width: '100%', height: '100%'});\r\n            thiz.zonediv.find('table').attr('rules', thiz.zone.rules);\r\n            thiz.resize(scalew, scaleh)\r\n        }).catch(function (err) {\r\n            console.log(err.message)\r\n        })\r\n    }\r\n    this.init()\r\n};\r\n"]}